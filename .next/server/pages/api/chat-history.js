"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chat-history";
exports.ids = ["pages/api/chat-history"];
exports.modules = {

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat-history&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cchat-history.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat-history&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cchat-history.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handler: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/api-utils */ \"(api-node)/./node_modules/next/dist/server/api-utils/index.js\");\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_chat_history_ts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./src\\pages\\api\\chat-history.ts */ \"(api-node)/./src/pages/api/chat-history.ts\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(api-node)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(api-node)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__);\n\n\n\n\n// Import the userland code.\n\n\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_src_pages_api_chat_history_ts__WEBPACK_IMPORTED_MODULE_4__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_src_pages_api_chat_history_ts__WEBPACK_IMPORTED_MODULE_4__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/chat-history\",\n        pathname: \"/api/chat-history\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _src_pages_api_chat_history_ts__WEBPACK_IMPORTED_MODULE_4__,\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || ''\n});\nasync function handler(req, res, ctx) {\n    let srcPage = \"/api/chat-history\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {}\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.getTracer)();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: [],\n                multiZoneDraftMode: Boolean(false),\n                trustHostHeader: false,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/chat-history\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        (0,next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__.sendError)(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGY2hhdC1oaXN0b3J5JnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGc3JjJTVDcGFnZXMlNUNhcGklNUNjaGF0LWhpc3RvcnkudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXVEO0FBQ0M7QUFDdUM7QUFDckM7QUFDMUQ7QUFDK0Q7QUFDUztBQUNGO0FBQ3RFO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQywyREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsMkRBQVE7QUFDcEM7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixhQUFhLE9BQW9DLElBQUksQ0FBRTtBQUN2RCx3QkFBd0IsTUFBdUM7QUFDL0QsQ0FBQztBQUNNO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLEtBQXFCLEVBQUUsRUFFMUI7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksd0RBQXdEO0FBQ3BFO0FBQ0E7QUFDQSx1QkFBdUIsNEVBQVM7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsNkNBQTZDLEVBQTZDO0FBQzFGLDRDQUE0QyxLQUF3QztBQUNwRixpQ0FBaUMsS0FBb0M7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLGdGQUFjO0FBQy9FLCtEQUErRCx5Q0FBeUM7QUFDeEc7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsUUFBUSxFQUFFLE1BQU07QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxrQkFBa0I7QUFDbEIsdUNBQXVDLFFBQVEsRUFBRSxRQUFRO0FBQ3pEO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLDZFQUE2RSxnRkFBYztBQUMzRixpQ0FBaUMsUUFBUSxFQUFFLFFBQVE7QUFDbkQsMEJBQTBCLHVFQUFRO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEscUVBQVM7QUFDakIsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNlbmRFcnJvciB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2FwaS11dGlsc1wiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9zcmNcXFxccGFnZXNcXFxcYXBpXFxcXGNoYXQtaGlzdG9yeS50c1wiO1xuaW1wb3J0IHsgZ2V0VHJhY2VyLCBTcGFuS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS90cmFjZXJcIjtcbmltcG9ydCB7IEJhc2VTZXJ2ZXJTcGFuIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL2NvbnN0YW50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCAnZGVmYXVsdCcpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgJ2NvbmZpZycpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jaGF0LWhpc3RvcnlcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jaGF0LWhpc3RvcnlcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiAnJyxcbiAgICAgICAgZmlsZW5hbWU6ICcnXG4gICAgfSxcbiAgICB1c2VybGFuZCxcbiAgICBkaXN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfRElTVF9ESVIgfHwgJycsXG4gICAgcmVsYXRpdmVQcm9qZWN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfUFJPSkVDVF9ESVIgfHwgJydcbn0pO1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMsIGN0eCkge1xuICAgIGxldCBzcmNQYWdlID0gXCIvYXBpL2NoYXQtaGlzdG9yeVwiO1xuICAgIC8vIHR1cmJvcGFjayBkb2Vzbid0IG5vcm1hbGl6ZSBgL2luZGV4YCBpbiB0aGUgcGFnZSBuYW1lXG4gICAgLy8gc28gd2UgbmVlZCB0byB0byBwcm9jZXNzIGR5bmFtaWMgcm91dGVzIHByb3Blcmx5XG4gICAgLy8gVE9ETzogZml4IHR1cmJvcGFjayBwcm92aWRpbmcgZGlmZmVyaW5nIHZhbHVlIGZyb20gd2VicGFja1xuICAgIGlmIChwcm9jZXNzLmVudi5UVVJCT1BBQ0spIHtcbiAgICAgICAgc3JjUGFnZSA9IHNyY1BhZ2UucmVwbGFjZSgvXFwvaW5kZXgkLywgJycpIHx8ICcvJztcbiAgICB9XG4gICAgY29uc3QgcHJlcGFyZVJlc3VsdCA9IGF3YWl0IHJvdXRlTW9kdWxlLnByZXBhcmUocmVxLCByZXMsIHtcbiAgICAgICAgc3JjUGFnZVxuICAgIH0pO1xuICAgIGlmICghcHJlcGFyZVJlc3VsdCkge1xuICAgICAgICByZXMuc3RhdHVzQ29kZSA9IDQwMDtcbiAgICAgICAgcmVzLmVuZCgnQmFkIFJlcXVlc3QnKTtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgcXVlcnksIHBhcmFtcywgcHJlcmVuZGVyTWFuaWZlc3QsIHJvdXRlclNlcnZlckNvbnRleHQgfSA9IHByZXBhcmVSZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gcmVxLm1ldGhvZCB8fCAnR0VUJztcbiAgICAgICAgY29uc3QgdHJhY2VyID0gZ2V0VHJhY2VyKCk7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVNwYW4gPSB0cmFjZXIuZ2V0QWN0aXZlU2NvcGVTcGFuKCk7XG4gICAgICAgIGNvbnN0IG9uUmVxdWVzdEVycm9yID0gcm91dGVNb2R1bGUuaW5zdHJ1bWVudGF0aW9uT25SZXF1ZXN0RXJyb3IuYmluZChyb3V0ZU1vZHVsZSk7XG4gICAgICAgIGNvbnN0IGludm9rZVJvdXRlTW9kdWxlID0gYXN5bmMgKHNwYW4pPT5yb3V0ZU1vZHVsZS5yZW5kZXIocmVxLCByZXMsIHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICAuLi5xdWVyeSxcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFyYW1zXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgYWxsb3dlZFJldmFsaWRhdGVIZWFkZXJLZXlzOiBwcm9jZXNzLmVudi5fX05FWFRfQUxMT1dFRF9SRVZBTElEQVRFX0hFQURFUlMsXG4gICAgICAgICAgICAgICAgbXVsdGlab25lRHJhZnRNb2RlOiBCb29sZWFuKHByb2Nlc3MuZW52Ll9fTkVYVF9NVUxUSV9aT05FX0RSQUZUX01PREUpLFxuICAgICAgICAgICAgICAgIHRydXN0SG9zdEhlYWRlcjogcHJvY2Vzcy5lbnYuX19ORVhUX1RSVVNUX0hPU1RfSEVBREVSLFxuICAgICAgICAgICAgICAgIC8vIFRPRE86IGdldCB0aGlzIGZyb20gZnJvbSBydW50aW1lIGVudiBzbyBtYW5pZmVzdFxuICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3QgbmVlZCB0byBsb2FkXG4gICAgICAgICAgICAgICAgcHJldmlld1Byb3BzOiBwcmVyZW5kZXJNYW5pZmVzdC5wcmV2aWV3LFxuICAgICAgICAgICAgICAgIHByb3BhZ2F0ZUVycm9yOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkZXY6IHJvdXRlTW9kdWxlLmlzRGV2LFxuICAgICAgICAgICAgICAgIHBhZ2U6IFwiL2FwaS9jaGF0LWhpc3RvcnlcIixcbiAgICAgICAgICAgICAgICBpbnRlcm5hbFJldmFsaWRhdGU6IHJvdXRlclNlcnZlckNvbnRleHQgPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlclNlcnZlckNvbnRleHQucmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICBvbkVycm9yOiAoLi4uYXJncyk9Pm9uUmVxdWVzdEVycm9yKHJlcSwgLi4uYXJncylcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoKCk9PntcbiAgICAgICAgICAgICAgICBpZiAoIXNwYW4pIHJldHVybjtcbiAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAnaHR0cC5zdGF0dXNfY29kZSc6IHJlcy5zdGF0dXNDb2RlLFxuICAgICAgICAgICAgICAgICAgICAnbmV4dC5yc2MnOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb3RTcGFuQXR0cmlidXRlcyA9IHRyYWNlci5nZXRSb290U3BhbkF0dHJpYnV0ZXMoKTtcbiAgICAgICAgICAgICAgICAvLyBXZSB3ZXJlIHVuYWJsZSB0byBnZXQgYXR0cmlidXRlcywgcHJvYmFibHkgT1RFTCBpcyBub3QgZW5hYmxlZFxuICAgICAgICAgICAgICAgIGlmICghcm9vdFNwYW5BdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJykgIT09IEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbmV4cGVjdGVkIHJvb3Qgc3BhbiB0eXBlICcke3Jvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJyl9Jy4gUGxlYXNlIHJlcG9ydCB0aGlzIE5leHQuanMgaXNzdWUgaHR0cHM6Ly9naXRodWIuY29tL3ZlcmNlbC9uZXh0LmpzYCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgcm91dGUgPSByb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnJvdXRlJyk7XG4gICAgICAgICAgICAgICAgaWYgKHJvdXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBgJHttZXRob2R9ICR7cm91dGV9YDtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQuc3Bhbl9uYW1lJzogbmFtZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKG5hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShgJHttZXRob2R9ICR7cmVxLnVybH1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgLy8gVE9ETzogYWN0aXZlU3BhbiBjb2RlIHBhdGggaXMgZm9yIHdoZW4gd3JhcHBlZCBieVxuICAgICAgICAvLyBuZXh0LXNlcnZlciBjYW4gYmUgcmVtb3ZlZCB3aGVuIHRoaXMgaXMgbm8gbG9uZ2VyIHVzZWRcbiAgICAgICAgaWYgKGFjdGl2ZVNwYW4pIHtcbiAgICAgICAgICAgIGF3YWl0IGludm9rZVJvdXRlTW9kdWxlKGFjdGl2ZVNwYW4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdHJhY2VyLndpdGhQcm9wYWdhdGVkQ29udGV4dChyZXEuaGVhZGVycywgKCk9PnRyYWNlci50cmFjZShCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0LCB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW5OYW1lOiBgJHttZXRob2R9ICR7cmVxLnVybH1gLFxuICAgICAgICAgICAgICAgICAgICBraW5kOiBTcGFuS2luZC5TRVJWRVIsXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLm1ldGhvZCc6IG1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnRhcmdldCc6IHJlcS51cmxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGludm9rZVJvdXRlTW9kdWxlKSk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gd2UgcmUtdGhyb3cgaW4gZGV2IHRvIHNob3cgdGhlIGVycm9yIG92ZXJsYXlcbiAgICAgICAgaWYgKHJvdXRlTW9kdWxlLmlzRGV2KSB7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhpcyBpcyB0ZWNobmljYWxseSBhbiBpbnZhcmlhbnQgYXMgZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgLy8gc2hvdWxkIGJlIGRvbmUgaW5zaWRlIG9mIGFwaS1yZXNvbHZlciBvbkVycm9yXG4gICAgICAgIHNlbmRFcnJvcihyZXMsIDUwMCwgJ0ludGVybmFsIFNlcnZlciBFcnJvcicpO1xuICAgIH0gZmluYWxseXtcbiAgICAgICAgLy8gV2UgZG9uJ3QgYWxsb3cgYW55IHdhaXRVbnRpbCB3b3JrIGluIHBhZ2VzIEFQSSByb3V0ZXMgY3VycmVudGx5XG4gICAgICAgIC8vIHNvIGlmIGNhbGxiYWNrIGlzIHByZXNlbnQgcmV0dXJuIHdpdGggcmVzb2x2ZWQgcHJvbWlzZSBzaW5jZSBub1xuICAgICAgICAvLyBwZW5kaW5nIHdvcmtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgIH1cbn1cblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat-history&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cchat-history.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./src/lib/mongo.ts":
/*!**************************!*\
  !*** ./src/lib/mongo.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst uri = process.env.MONGODB_URI;\nif (!uri) {\n    throw new Error(\"MONGODB_URI is not set in environment variables\");\n}\nlet client;\nlet clientPromise;\nif (true) {\n    if (!global._mongoClientPromise) {\n        client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri);\n        global._mongoClientPromise = client.connect();\n    }\n    clientPromise = global._mongoClientPromise;\n} else {}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3NyYy9saWIvbW9uZ28udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXNDO0FBRXRDLE1BQU1DLE1BQU1DLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVztBQUNuQyxJQUFJLENBQUNILEtBQUs7SUFDUixNQUFNLElBQUlJLE1BQU07QUFDbEI7QUFPQSxJQUFJQztBQUNKLElBQUlDO0FBRUosSUFBSUwsSUFBc0MsRUFBRTtJQUMxQyxJQUFJLENBQUNNLE9BQU9DLG1CQUFtQixFQUFFO1FBQy9CSCxTQUFTLElBQUlOLGdEQUFXQSxDQUFDQztRQUN6Qk8sT0FBT0MsbUJBQW1CLEdBQUdILE9BQU9JLE9BQU87SUFDN0M7SUFDQUgsZ0JBQWdCQyxPQUFPQyxtQkFBbUI7QUFDNUMsT0FBTyxFQUdOO0FBRUQsaUVBQWVGLGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xca2FydGlcXERlc2t0b3BcXENoYXRHcHRDbG9uZVxcc3JjXFxsaWJcXG1vbmdvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSBcIm1vbmdvZGJcIjtcclxuXHJcbmNvbnN0IHVyaSA9IHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJIGFzIHN0cmluZztcclxuaWYgKCF1cmkpIHtcclxuICB0aHJvdyBuZXcgRXJyb3IoXCJNT05HT0RCX1VSSSBpcyBub3Qgc2V0IGluIGVudmlyb25tZW50IHZhcmlhYmxlc1wiKTtcclxufVxyXG5cclxuZGVjbGFyZSBnbG9iYWwge1xyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby12YXJcclxuICB2YXIgX21vbmdvQ2xpZW50UHJvbWlzZTogUHJvbWlzZTxNb25nb0NsaWVudD4gfCB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmxldCBjbGllbnQ6IE1vbmdvQ2xpZW50O1xyXG5sZXQgY2xpZW50UHJvbWlzZTogUHJvbWlzZTxNb25nb0NsaWVudD47XHJcblxyXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIikge1xyXG4gIGlmICghZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UpIHtcclxuICAgIGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmkpO1xyXG4gICAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UgPSBjbGllbnQuY29ubmVjdCgpO1xyXG4gIH1cclxuICBjbGllbnRQcm9taXNlID0gZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UhO1xyXG59IGVsc2Uge1xyXG4gIGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmkpO1xyXG4gIGNsaWVudFByb21pc2UgPSBjbGllbnQuY29ubmVjdCgpO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnRQcm9taXNlO1xyXG5cclxuXHJcbiJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwiY2xpZW50IiwiY2xpZW50UHJvbWlzZSIsImdsb2JhbCIsIl9tb25nb0NsaWVudFByb21pc2UiLCJjb25uZWN0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./src/lib/mongo.ts\n");

/***/ }),

/***/ "(api-node)/./src/pages/api/chat-history.ts":
/*!***************************************!*\
  !*** ./src/pages/api/chat-history.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_mongo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/mongo */ \"(api-node)/./src/lib/mongo.ts\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clerk/nextjs/server */ \"@clerk/nextjs/server\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n// src/pages/api/chat-history.ts\n\n\n\nconst dbName = process.env.MONGODB_DB || \"chatgpt-clone\";\nasync function handler(req, res) {\n    const { userId } = (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_1__.getAuth)(req);\n    if (!userId) {\n        return res.status(401).json({\n            error: \"Unauthorized\"\n        });\n    }\n    try {\n        const client = await _lib_mongo__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n        const db = client.db(dbName);\n        const chats = db.collection(\"chats\");\n        const threads = db.collection(\"threads\");\n        // Ensure indexes (idempotent)\n        await chats.createIndex({\n            user: 1,\n            threadId: 1,\n            createdAt: 1\n        });\n        if (req.method === \"GET\") {\n            const { threadId, limit } = req.query;\n            const query = {\n                user: userId\n            };\n            if (threadId) query.threadId = threadId;\n            const max = Math.min(Number(limit) || 100, 200);\n            const raw = await chats.find(query).sort({\n                createdAt: 1\n            }).limit(max).toArray();\n            const userChats = raw.map((d)=>({\n                    ...d,\n                    _id: String(d._id)\n                }));\n            return res.status(200).json(userChats);\n        }\n        if (req.method === \"POST\") {\n            const { content, role, threadId, model, turnId } = req.body || {};\n            if (!content || typeof content !== \"string\") {\n                return res.status(400).json({\n                    error: \"content is required\"\n                });\n            }\n            if (role !== \"user\" && role !== \"assistant\") {\n                return res.status(400).json({\n                    error: \"role must be 'user' or 'assistant'\"\n                });\n            }\n            if (!threadId || typeof threadId !== \"string\") {\n                return res.status(400).json({\n                    error: \"threadId is required\"\n                });\n            }\n            // Ensure the thread exists and belongs to user\n            if (!mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId.isValid(threadId)) {\n                return res.status(400).json({\n                    error: \"Invalid threadId\"\n                });\n            }\n            const thread = await threads.findOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(threadId),\n                user: userId\n            });\n            if (!thread) {\n                return res.status(404).json({\n                    error: \"Thread not found\"\n                });\n            }\n            // Turn-based storage: one document per user+assistant pair\n            if (role === 'user') {\n                const now = new Date();\n                const turnDoc = {\n                    user: userId,\n                    threadId,\n                    userContent: content,\n                    assistantContent: null,\n                    // versioning\n                    versions: [\n                        {\n                            userContent: content,\n                            assistantContent: null,\n                            createdAt: now\n                        }\n                    ],\n                    currentVersion: 0,\n                    model: model || null,\n                    createdAt: now,\n                    updatedAt: now\n                };\n                const result = await chats.insertOne(turnDoc);\n                const update = {\n                    updatedAt: now\n                };\n                if ((!thread.title || thread.title === 'New conversation') && typeof content === 'string') {\n                    update.title = content.slice(0, 60);\n                }\n                await threads.updateOne({\n                    _id: thread._id\n                }, {\n                    $set: update\n                });\n                return res.status(201).json({\n                    _id: result.insertedId.toHexString(),\n                    ...turnDoc\n                });\n            }\n            // role === 'assistant' must update existing turn\n            if (!turnId) {\n                return res.status(400).json({\n                    error: \"turnId is required for assistant replies\"\n                });\n            }\n            if (!mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId.isValid(turnId)) {\n                return res.status(400).json({\n                    error: \"Invalid turnId\"\n                });\n            }\n            const oid = new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(turnId);\n            const doc = await chats.findOne({\n                _id: oid,\n                user: userId,\n                threadId\n            });\n            if (!doc) return res.status(404).json({\n                error: 'Turn not found'\n            });\n            const versionIndex = typeof doc.currentVersion === 'number' ? doc.currentVersion : 0;\n            const result = await chats.updateOne({\n                _id: oid\n            }, {\n                $set: {\n                    assistantContent: content,\n                    model: model || null,\n                    updatedAt: new Date(),\n                    [`versions.${versionIndex}.assistantContent`]: content\n                }\n            });\n            if (result.matchedCount === 0) {\n                return res.status(404).json({\n                    error: 'Turn not found'\n                });\n            }\n            await threads.updateOne({\n                _id: thread._id\n            }, {\n                $set: {\n                    updatedAt: new Date()\n                }\n            });\n            return res.status(200).json({\n                _id: turnId,\n                ok: true\n            });\n        }\n        if (req.method === \"PATCH\") {\n            const { turnId, threadId, content } = req.body || {};\n            if (!turnId || !threadId || typeof content !== 'string') {\n                return res.status(400).json({\n                    error: \"turnId, threadId and content are required\"\n                });\n            }\n            if (!mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId.isValid(turnId) || !mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId.isValid(threadId)) {\n                return res.status(400).json({\n                    error: \"Invalid id(s)\"\n                });\n            }\n            const thread = await threads.findOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(threadId),\n                user: userId\n            });\n            if (!thread) return res.status(404).json({\n                error: \"Thread not found\"\n            });\n            const doc = await chats.findOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(turnId),\n                user: userId,\n                threadId\n            });\n            if (!doc) return res.status(404).json({\n                error: \"Turn not found\"\n            });\n            const newIndex = Array.isArray(doc.versions) ? doc.versions.length : 0;\n            const update = {\n                $set: {\n                    userContent: content,\n                    assistantContent: null,\n                    currentVersion: newIndex,\n                    updatedAt: new Date()\n                },\n                $push: {\n                    versions: {\n                        userContent: content,\n                        assistantContent: null,\n                        createdAt: new Date()\n                    }\n                }\n            };\n            const result = await chats.updateOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(turnId)\n            }, update);\n            if (result.matchedCount === 0) return res.status(404).json({\n                error: \"Turn not found\"\n            });\n            await threads.updateOne({\n                _id: thread._id\n            }, {\n                $set: {\n                    updatedAt: new Date(),\n                    title: thread.title || content.slice(0, 60)\n                }\n            });\n            return res.status(200).json({\n                ok: true\n            });\n        }\n        if (req.method === \"PUT\") {\n            // Set currentVersion\n            const { turnId, threadId, version } = req.body || {};\n            if (!turnId || !threadId || typeof version !== 'number') {\n                return res.status(400).json({\n                    error: \"turnId, threadId and numeric version are required\"\n                });\n            }\n            if (!mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId.isValid(turnId) || !mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId.isValid(threadId)) {\n                return res.status(400).json({\n                    error: \"Invalid id(s)\"\n                });\n            }\n            const doc = await chats.findOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(turnId),\n                user: userId,\n                threadId\n            });\n            if (!doc) return res.status(404).json({\n                error: \"Turn not found\"\n            });\n            const total = Array.isArray(doc.versions) ? doc.versions.length : 0;\n            if (version < 0 || version >= total) return res.status(400).json({\n                error: \"Version out of range\"\n            });\n            await chats.updateOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(turnId)\n            }, {\n                $set: {\n                    currentVersion: version,\n                    updatedAt: new Date(),\n                    userContent: doc.versions[version].userContent,\n                    assistantContent: doc.versions[version].assistantContent || null\n                }\n            });\n            await threads.updateOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(threadId)\n            }, {\n                $set: {\n                    updatedAt: new Date()\n                }\n            });\n            return res.status(200).json({\n                ok: true\n            });\n        }\n        res.setHeader(\"Allow\", [\n            \"GET\",\n            \"POST\",\n            \"PATCH\",\n            \"PUT\"\n        ]);\n        return res.status(405).end(`Method ${req.method} Not Allowed`);\n    } catch (error) {\n        console.error(error);\n        return res.status(500).json({\n            error: error.message || \"Internal Server Error\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3NyYy9wYWdlcy9hcGkvY2hhdC1oaXN0b3J5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLGdDQUFnQztBQUVRO0FBQ087QUFDWjtBQUVuQyxNQUFNRyxTQUFTQyxRQUFRQyxHQUFHLENBQUNDLFVBQVUsSUFBSTtBQUUxQixlQUFlQyxRQUFRQyxHQUFtQixFQUFFQyxHQUFvQjtJQUM3RSxNQUFNLEVBQUVDLE1BQU0sRUFBRSxHQUFHVCw2REFBT0EsQ0FBQ087SUFFM0IsSUFBSSxDQUFDRSxRQUFRO1FBQ1gsT0FBT0QsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWU7SUFDdEQ7SUFFQSxJQUFJO1FBQ0YsTUFBTUMsU0FBUyxNQUFNZCxrREFBYUE7UUFDbEMsTUFBTWUsS0FBS0QsT0FBT0MsRUFBRSxDQUFDWjtRQUNyQixNQUFNYSxRQUFRRCxHQUFHRSxVQUFVLENBQUM7UUFDNUIsTUFBTUMsVUFBVUgsR0FBR0UsVUFBVSxDQUFDO1FBRTlCLDhCQUE4QjtRQUM5QixNQUFNRCxNQUFNRyxXQUFXLENBQUM7WUFBRUMsTUFBTTtZQUFHQyxVQUFVO1lBQUdDLFdBQVc7UUFBRTtRQUU3RCxJQUFJZCxJQUFJZSxNQUFNLEtBQUssT0FBTztZQUN4QixNQUFNLEVBQUVGLFFBQVEsRUFBRUcsS0FBSyxFQUFFLEdBQUdoQixJQUFJaUIsS0FBSztZQUNyQyxNQUFNQSxRQUFhO2dCQUFFTCxNQUFNVjtZQUFPO1lBQ2xDLElBQUlXLFVBQVVJLE1BQU1KLFFBQVEsR0FBR0E7WUFDL0IsTUFBTUssTUFBTUMsS0FBS0MsR0FBRyxDQUFDQyxPQUFPTCxVQUFVLEtBQUs7WUFDM0MsTUFBTU0sTUFBTSxNQUFNZCxNQUNmZSxJQUFJLENBQUNOLE9BQ0xPLElBQUksQ0FBQztnQkFBRVYsV0FBVztZQUFFLEdBQ3BCRSxLQUFLLENBQUNFLEtBQ05PLE9BQU87WUFDVixNQUFNQyxZQUFZSixJQUFJSyxHQUFHLENBQUMsQ0FBQ0Ms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RSxPQUFPLElBQUk7UUFBd0I7SUFDaEY7QUFDRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxrYXJ0aVxcRGVza3RvcFxcQ2hhdEdwdENsb25lXFxzcmNcXHBhZ2VzXFxhcGlcXGNoYXQtaGlzdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvcGFnZXMvYXBpL2NoYXQtaGlzdG9yeS50c1xyXG5pbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tIFwibmV4dFwiO1xyXG5pbXBvcnQgY2xpZW50UHJvbWlzZSBmcm9tIFwiQC9saWIvbW9uZ29cIjtcclxuaW1wb3J0IHsgZ2V0QXV0aCB9IGZyb20gXCJAY2xlcmsvbmV4dGpzL3NlcnZlclwiO1xyXG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gXCJtb25nb2RiXCI7XHJcblxyXG5jb25zdCBkYk5hbWUgPSBwcm9jZXNzLmVudi5NT05HT0RCX0RCIHx8IFwiY2hhdGdwdC1jbG9uZVwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xyXG4gIGNvbnN0IHsgdXNlcklkIH0gPSBnZXRBdXRoKHJlcSk7XHJcblxyXG4gIGlmICghdXNlcklkKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogXCJVbmF1dGhvcml6ZWRcIiB9KTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBjbGllbnRQcm9taXNlO1xyXG4gICAgY29uc3QgZGIgPSBjbGllbnQuZGIoZGJOYW1lKTtcclxuICAgIGNvbnN0IGNoYXRzID0gZGIuY29sbGVjdGlvbihcImNoYXRzXCIpO1xyXG4gICAgY29uc3QgdGhyZWFkcyA9IGRiLmNvbGxlY3Rpb24oXCJ0aHJlYWRzXCIpO1xyXG5cclxuICAgIC8vIEVuc3VyZSBpbmRleGVzIChpZGVtcG90ZW50KVxyXG4gICAgYXdhaXQgY2hhdHMuY3JlYXRlSW5kZXgoeyB1c2VyOiAxLCB0aHJlYWRJZDogMSwgY3JlYXRlZEF0OiAxIH0pO1xyXG5cclxuICAgIGlmIChyZXEubWV0aG9kID09PSBcIkdFVFwiKSB7XHJcbiAgICAgIGNvbnN0IHsgdGhyZWFkSWQsIGxpbWl0IH0gPSByZXEucXVlcnkgYXMgeyB0aHJlYWRJZD86IHN0cmluZzsgbGltaXQ/OiBzdHJpbmcgfTtcclxuICAgICAgY29uc3QgcXVlcnk6IGFueSA9IHsgdXNlcjogdXNlcklkIH07XHJcbiAgICAgIGlmICh0aHJlYWRJZCkgcXVlcnkudGhyZWFkSWQgPSB0aHJlYWRJZDtcclxuICAgICAgY29uc3QgbWF4ID0gTWF0aC5taW4oTnVtYmVyKGxpbWl0KSB8fCAxMDAsIDIwMCk7XHJcbiAgICAgIGNvbnN0IHJhdyA9IGF3YWl0IGNoYXRzXHJcbiAgICAgICAgLmZpbmQocXVlcnkpXHJcbiAgICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IDEgfSlcclxuICAgICAgICAubGltaXQobWF4KVxyXG4gICAgICAgIC50b0FycmF5KCk7XHJcbiAgICAgIGNvbnN0IHVzZXJDaGF0cyA9IHJhdy5tYXAoKGQ6IGFueSkgPT4gKHsgLi4uZCwgX2lkOiBTdHJpbmcoZC5faWQpIH0pKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHVzZXJDaGF0cyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlcS5tZXRob2QgPT09IFwiUE9TVFwiKSB7XHJcbiAgICAgIGNvbnN0IHsgY29udGVudCwgcm9sZSwgdGhyZWFkSWQsIG1vZGVsLCB0dXJuSWQgfSA9IHJlcS5ib2R5IHx8IHt9O1xyXG4gICAgICBpZiAoIWNvbnRlbnQgfHwgdHlwZW9mIGNvbnRlbnQgIT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJjb250ZW50IGlzIHJlcXVpcmVkXCIgfSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHJvbGUgIT09IFwidXNlclwiICYmIHJvbGUgIT09IFwiYXNzaXN0YW50XCIpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJyb2xlIG11c3QgYmUgJ3VzZXInIG9yICdhc3Npc3RhbnQnXCIgfSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCF0aHJlYWRJZCB8fCB0eXBlb2YgdGhyZWFkSWQgIT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJ0aHJlYWRJZCBpcyByZXF1aXJlZFwiIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBFbnN1cmUgdGhlIHRocmVhZCBleGlzdHMgYW5kIGJlbG9uZ3MgdG8gdXNlclxyXG4gICAgICBpZiAoIU9iamVjdElkLmlzVmFsaWQodGhyZWFkSWQpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiSW52YWxpZCB0aHJlYWRJZFwiIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHRocmVhZCA9IGF3YWl0IHRocmVhZHMuZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKHRocmVhZElkKSwgdXNlcjogdXNlcklkIH0pO1xyXG4gICAgICBpZiAoIXRocmVhZCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiBcIlRocmVhZCBub3QgZm91bmRcIiB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVHVybi1iYXNlZCBzdG9yYWdlOiBvbmUgZG9jdW1lbnQgcGVyIHVzZXIrYXNzaXN0YW50IHBhaXJcclxuICAgICAgaWYgKHJvbGUgPT09ICd1c2VyJykge1xyXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgY29uc3QgdHVybkRvYyA9IHtcclxuICAgICAgICAgIHVzZXI6IHVzZXJJZCxcclxuICAgICAgICAgIHRocmVhZElkLFxyXG4gICAgICAgICAgdXNlckNvbnRlbnQ6IGNvbnRlbnQsXHJcbiAgICAgICAgICBhc3Npc3RhbnRDb250ZW50OiBudWxsIGFzIHN0cmluZyB8IG51bGwsXHJcbiAgICAgICAgICAvLyB2ZXJzaW9uaW5nXHJcbiAgICAgICAgICB2ZXJzaW9uczogW1xyXG4gICAgICAgICAgICB7IHVzZXJDb250ZW50OiBjb250ZW50LCBhc3Npc3RhbnRDb250ZW50OiBudWxsLCBjcmVhdGVkQXQ6IG5vdyB9LFxyXG4gICAgICAgICAgXSxcclxuICAgICAgICAgIGN1cnJlbnRWZXJzaW9uOiAwLFxyXG4gICAgICAgICAgbW9kZWw6IG1vZGVsIHx8IG51bGwsXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogbm93LFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2hhdHMuaW5zZXJ0T25lKHR1cm5Eb2MpO1xyXG4gICAgICAgIGNvbnN0IHVwZGF0ZTogYW55ID0geyB1cGRhdGVkQXQ6IG5vdyB9O1xyXG4gICAgICAgIGlmICgoIXRocmVhZC50aXRsZSB8fCB0aHJlYWQudGl0bGUgPT09ICdOZXcgY29udmVyc2F0aW9uJykgJiYgdHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICB1cGRhdGUudGl0bGUgPSBjb250ZW50LnNsaWNlKDAsIDYwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYXdhaXQgdGhyZWFkcy51cGRhdGVPbmUoeyBfaWQ6IHRocmVhZC5faWQgfSwgeyAkc2V0OiB1cGRhdGUgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKHsgX2lkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b0hleFN0cmluZygpLCAuLi50dXJuRG9jIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyByb2xlID09PSAnYXNzaXN0YW50JyBtdXN0IHVwZGF0ZSBleGlzdGluZyB0dXJuXHJcbiAgICAgIGlmICghdHVybklkKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwidHVybklkIGlzIHJlcXVpcmVkIGZvciBhc3Npc3RhbnQgcmVwbGllc1wiIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghT2JqZWN0SWQuaXNWYWxpZCh0dXJuSWQpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiSW52YWxpZCB0dXJuSWRcIiB9KTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBvaWQgPSBuZXcgT2JqZWN0SWQodHVybklkKTtcclxuICAgICAgY29uc3QgZG9jID0gYXdhaXQgY2hhdHMuZmluZE9uZSh7IF9pZDogb2lkLCB1c2VyOiB1c2VySWQsIHRocmVhZElkIH0pO1xyXG4gICAgICBpZiAoIWRvYykgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdUdXJuIG5vdCBmb3VuZCcgfSk7XHJcbiAgICAgIGNvbnN0IHZlcnNpb25JbmRleCA9IHR5cGVvZiBkb2MuY3VycmVudFZlcnNpb24gPT09ICdudW1iZXInID8gZG9jLmN1cnJlbnRWZXJzaW9uIDogMDtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2hhdHMudXBkYXRlT25lKFxyXG4gICAgICAgIHsgX2lkOiBvaWQgfSxcclxuICAgICAgICB7ICRzZXQ6IHsgYXNzaXN0YW50Q29udGVudDogY29udGVudCwgbW9kZWw6IG1vZGVsIHx8IG51bGwsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSwgW2B2ZXJzaW9ucy4ke3ZlcnNpb25JbmRleH0uYXNzaXN0YW50Q29udGVudGBdOiBjb250ZW50IH0gfVxyXG4gICAgICApO1xyXG4gICAgICBpZiAocmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnVHVybiBub3QgZm91bmQnIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIGF3YWl0IHRocmVhZHMudXBkYXRlT25lKHsgX2lkOiB0aHJlYWQuX2lkIH0sIHsgJHNldDogeyB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSB9KTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgX2lkOiB0dXJuSWQsIG9rOiB0cnVlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXEubWV0aG9kID09PSBcIlBBVENIXCIpIHtcclxuICAgICAgY29uc3QgeyB0dXJuSWQsIHRocmVhZElkLCBjb250ZW50IH0gPSByZXEuYm9keSB8fCB7fTtcclxuICAgICAgaWYgKCF0dXJuSWQgfHwgIXRocmVhZElkIHx8IHR5cGVvZiBjb250ZW50ICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcInR1cm5JZCwgdGhyZWFkSWQgYW5kIGNvbnRlbnQgYXJlIHJlcXVpcmVkXCIgfSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFPYmplY3RJZC5pc1ZhbGlkKHR1cm5JZCkgfHwgIU9iamVjdElkLmlzVmFsaWQodGhyZWFkSWQpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiSW52YWxpZCBpZChzKVwiIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHRocmVhZCA9IGF3YWl0IHRocmVhZHMuZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKHRocmVhZElkKSwgdXNlcjogdXNlcklkIH0pO1xyXG4gICAgICBpZiAoIXRocmVhZCkgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6IFwiVGhyZWFkIG5vdCBmb3VuZFwiIH0pO1xyXG4gICAgICBjb25zdCBkb2MgPSBhd2FpdCBjaGF0cy5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQodHVybklkKSwgdXNlcjogdXNlcklkLCB0aHJlYWRJZCB9KTtcclxuICAgICAgaWYgKCFkb2MpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiBcIlR1cm4gbm90IGZvdW5kXCIgfSk7XHJcbiAgICAgIGNvbnN0IG5ld0luZGV4ID0gQXJyYXkuaXNBcnJheShkb2MudmVyc2lvbnMpID8gZG9jLnZlcnNpb25zLmxlbmd0aCA6IDA7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZTogYW55ID0ge1xyXG4gICAgICAgICRzZXQ6IHtcclxuICAgICAgICAgIHVzZXJDb250ZW50OiBjb250ZW50LFxyXG4gICAgICAgICAgYXNzaXN0YW50Q29udGVudDogbnVsbCxcclxuICAgICAgICAgIGN1cnJlbnRWZXJzaW9uOiBuZXdJbmRleCxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICB9LFxyXG4gICAgICAgICRwdXNoOiB7XHJcbiAgICAgICAgICB2ZXJzaW9uczogeyB1c2VyQ29udGVudDogY29udGVudCwgYXNzaXN0YW50Q29udGVudDogbnVsbCwgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2hhdHMudXBkYXRlT25lKFxyXG4gICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQodHVybklkKSB9LFxyXG4gICAgICAgIHVwZGF0ZSBhcyBhbnlcclxuICAgICAgKTtcclxuICAgICAgaWYgKHJlc3VsdC5tYXRjaGVkQ291bnQgPT09IDApIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiBcIlR1cm4gbm90IGZvdW5kXCIgfSk7XHJcbiAgICAgIGF3YWl0IHRocmVhZHMudXBkYXRlT25lKHsgX2lkOiB0aHJlYWQuX2lkIH0sIHsgJHNldDogeyB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksIHRpdGxlOiB0aHJlYWQudGl0bGUgfHwgY29udGVudC5zbGljZSgwLCA2MCkgfSB9KTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgb2s6IHRydWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlcS5tZXRob2QgPT09IFwiUFVUXCIpIHtcclxuICAgICAgLy8gU2V0IGN1cnJlbnRWZXJzaW9uXHJcbiAgICAgIGNvbnN0IHsgdHVybklkLCB0aHJlYWRJZCwgdmVyc2lvbiB9ID0gcmVxLmJvZHkgfHwge307XHJcbiAgICAgIGlmICghdHVybklkIHx8ICF0aHJlYWRJZCB8fCB0eXBlb2YgdmVyc2lvbiAhPT0gJ251bWJlcicpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJ0dXJuSWQsIHRocmVhZElkIGFuZCBudW1lcmljIHZlcnNpb24gYXJlIHJlcXVpcmVkXCIgfSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFPYmplY3RJZC5pc1ZhbGlkKHR1cm5JZCkgfHwgIU9iamVjdElkLmlzVmFsaWQodGhyZWFkSWQpKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiSW52YWxpZCBpZChzKVwiIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGRvYyA9IGF3YWl0IGNoYXRzLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZCh0dXJuSWQpLCB1c2VyOiB1c2VySWQsIHRocmVhZElkIH0pO1xyXG4gICAgICBpZiAoIWRvYykgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6IFwiVHVybiBub3QgZm91bmRcIiB9KTtcclxuICAgICAgY29uc3QgdG90YWwgPSBBcnJheS5pc0FycmF5KGRvYy52ZXJzaW9ucykgPyBkb2MudmVyc2lvbnMubGVuZ3RoIDogMDtcclxuICAgICAgaWYgKHZlcnNpb24gPCAwIHx8IHZlcnNpb24gPj0gdG90YWwpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIlZlcnNpb24gb3V0IG9mIHJhbmdlXCIgfSk7XHJcbiAgICAgIGF3YWl0IGNoYXRzLnVwZGF0ZU9uZSh7IF9pZDogbmV3IE9iamVjdElkKHR1cm5JZCkgfSwgeyAkc2V0OiB7IGN1cnJlbnRWZXJzaW9uOiB2ZXJzaW9uLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksIHVzZXJDb250ZW50OiBkb2MudmVyc2lvbnNbdmVyc2lvbl0udXNlckNvbnRlbnQsIGFzc2lzdGFudENvbnRlbnQ6IGRvYy52ZXJzaW9uc1t2ZXJzaW9uXS5hc3Npc3RhbnRDb250ZW50IHx8IG51bGwgfSB9KTtcclxuICAgICAgYXdhaXQgdGhyZWFkcy51cGRhdGVPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZCh0aHJlYWRJZCkgfSwgeyAkc2V0OiB7IHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9IH0pO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBvazogdHJ1ZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXMuc2V0SGVhZGVyKFwiQWxsb3dcIiwgW1wiR0VUXCIsIFwiUE9TVFwiLCBcIlBBVENIXCIsIFwiUFVUXCJdKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuZW5kKGBNZXRob2QgJHtyZXEubWV0aG9kfSBOb3QgQWxsb3dlZGApO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgXCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3JcIiB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbImNsaWVudFByb21pc2UiLCJnZXRBdXRoIiwiT2JqZWN0SWQiLCJkYk5hbWUiLCJwcm9jZXNzIiwiZW52IiwiTU9OR09EQl9EQiIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJ1c2VySWQiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJjbGllbnQiLCJkYiIsImNoYXRzIiwiY29sbGVjdGlvbiIsInRocmVhZHMiLCJjcmVhdGVJbmRleCIsInVzZXIiLCJ0aHJlYWRJZCIsImNyZWF0ZWRBdCIsIm1ldGhvZCIsImxpbWl0IiwicXVlcnkiLCJtYXgiLCJNYXRoIiwibWluIiwiTnVtYmVyIiwicmF3IiwiZmluZCIsInNvcnQiLCJ0b0FycmF5IiwidXNlckNoYXRzIiwibWFwIiwiZCIsIl9pZCIsIlN0cmluZyIsImNvbnRlbnQiLCJyb2xlIiwibW9kZWwiLCJ0dXJuSWQiLCJib2R5IiwiaXNWYWxpZCIsInRocmVhZCIsImZpbmRPbmUiLCJub3ciLCJEYXRlIiwidHVybkRvYyIsInVzZXJDb250ZW50IiwiYXNzaXN0YW50Q29udGVudCIsInZlcnNpb25zIiwiY3VycmVudFZlcnNpb24iLCJ1cGRhdGVkQXQiLCJyZXN1bHQiLCJpbnNlcnRPbmUiLCJ1cGRhdGUiLCJ0aXRsZSIsInNsaWNlIiwidXBkYXRlT25lIiwiJHNldCIsImluc2VydGVkSWQiLCJ0b0hleFN0cmluZyIsIm9pZCIsImRvYyIsInZlcnNpb25JbmRleCIsIm1hdGNoZWRDb3VudCIsIm9rIiwibmV3SW5kZXgiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCIkcHVzaCIsInZlcnNpb24iLCJ0b3RhbCIsInNldEhlYWRlciIsImVuZCIsImNvbnNvbGUiLCJtZXNzYWdlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./src/pages/api/chat-history.ts\n");

/***/ }),

/***/ "@clerk/nextjs/server":
/*!***************************************!*\
  !*** external "@clerk/nextjs/server" ***!
  \***************************************/
/***/ ((module) => {

module.exports = require("@clerk/nextjs/server");

/***/ }),

/***/ "@opentelemetry/api":
/*!*************************************!*\
  !*** external "@opentelemetry/api" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("@opentelemetry/api");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fchat-history&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cchat-history.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();